<div ng-class="{'ng-hide': (workspaces | lodash:'isEmpty')}" class="categoryGrouping">
    <div ng-repeat="(workspace, gsLayers) in workspaces" class="categoryGrouping">
        <div class="categoryCell"><b>{{::workspace}}</b></div>
        <div ng-repeat="gsLayer in gsLayers" class="categoryGrouping categoryIndent">
            <div class="categoryCell">
                <i>{{::gsLayer.Title || gsLayer.Name | characters:35:true}}</i>
            </div>
            <div class="categoryCell">
                    <span class="btn btn-default fa-stack toggleButton"
                          ng-if="gsLayer.queryable"
                          ng-click="launchHistogramWizard(gsLayer)"
                          tooltip-html-unsafe="<span style='white-space:nowrap'>New histogram</span>"
                          tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"
                          tooltip-trigger="mouseenter">
                        <i class="fa fa-fw fa-plus fa-stack-1x text-primary"></i>
                    </span>
            </div>
            <div ng-repeat="derivedLayer in gsLayer.derivedLayers" class="categoryGrouping">
                <div class="categoryCell" ng-if="derivedLayer.viewState.isLoading" style="padding-left:2px;">
                    <div ng-if="derivedLayer.viewState.isLoading">
                        <i class="fa fa-circle-o-notch fa-spin"></i>
                    </div>
                </div>
                <div class="categoryCell">
                    <span ng-if="!derivedLayer.viewState.isLoading"
                          class="btn btn-default fa-stack toggleButton"
                          ng-click="showHistogram(derivedLayer.histogram)"
                          ng-style="{'background-color': derivedLayer.viewState.fillColor}"
                          tooltip-html-unsafe="<span style='white-space:nowrap'>Show histogram</span>"
                          tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"
                          tooltip-trigger="mouseenter">
                        <i class="fa fa-fw fa-chevron-up fa-stack-1x" style="color:white;"></i>
                    </span>
                </div>
                <div class="categoryCell">
                    <st-toggle-visibility ng-if="derivedLayer.viewState.isOnMap"
                                          visible="derivedLayer.viewState.toggledOn"
                                          toggle="toggleVisibility(derivedLayer)"></st-toggle-visibility>
                </div>
                <div class="categoryCell" style="width:100%">
                    <input type="text"
                           ng-model="derivedLayer.title"
                           ng-change="updateHistogramTitle(derivedLayer)"
                           style="border-radius:3px;width:100%;">
                </div>
                <div class="categoryCell">
                        <span class="btn btn-default fa-stack toggleButton"
                              ng-class="{active: !derivedLayer.viewState.isDraggable}"
                              ng-click="toggleDraggable(derivedLayer)"
                              tooltip-html-unsafe="<span style='white-space:nowrap'>Toggle dragging</span>"
                              tooltip-placement="left" tooltip-animation="false" tooltip-popup-delay="500"
                              tooltip-trigger="mouseenter">
                            <i class="fa fa-fw fa-thumb-tack fa-stack-1x"></i>
                        </span>
                </div>
                <div class="categoryCell" style="text-align:right;">
                        <span class="btn btn-default fa-stack toggleButton"
                              ng-if="derivedLayer.viewState.isRemovable"
                              ng-click="removeLayer(gsLayer, derivedLayer)">
                            <i class="fa fa-fw fa-close fa-stack-1x text-danger"></i>
                        </span>
                </div>
            </div>
        </div>
    </div>
</div>
